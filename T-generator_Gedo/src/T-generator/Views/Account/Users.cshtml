@using Microsoft.AspNetCore.Identity
@using T_generator.Models
@using T_generator.Data
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
    
@model IEnumerable<T_generator.Models.ApplicationUser>
    @{
        ViewData["Title"] = "Users";
    }
    <h2>@ViewData["Title"].</h2>
    <h3>@ViewData["Message"]</h3>

@if (Model != null &&
     Model.Count(x => x.IsPowerAdmin == false) != 0)
    {
    var currentUser = UserManager.GetUserAsync(User).Result;
    bool powerAdmin = currentUser.IsPowerAdmin;
    bool admin = currentUser.IsAdmin;

    <table class="table">
    <tr class="tab-pane">
        <th>User name</th>
        <th>User email</th>
        <th>User status</th>
    </tr>

    @foreach (var item in Model)
        {
        @if (!item.IsPowerAdmin)
            {
            bool checkUserIsAdmin = @item.IsAdmin;
            string checkUserName = @item.UserName;

            string isAdmin;
            if (checkUserIsAdmin)
                {
                isAdmin = "Admin";
                }
            else
                {
                isAdmin = "Not admin";
                }

            <tr>
                <td scope="row">@item.UserName</td>
                <td>@item.Email</td>
                <td>@isAdmin</td>

                @if (checkUserName == currentUser.UserName)
                    {
                    continue;
                    }
                
                @if (powerAdmin ||
                    (admin && !checkUserIsAdmin))
                    {
                    <td><a class="btn btn-info" asp-action="Modify" asp-route-userName="@item.UserName">Modify</a></td>
                    <td><a class="btn btn-info" asp-action="Delete" asp-route-userName="@item.UserName">Delete</a></td>
                    <td><a class="btn btn-info" asp-action="ResetPassword" asp-route-userName="@item.UserName">Reset password</a></td>
                    }
            </tr>
            }
        }
    </table>
    }
else
    {
    <h4>There are no users to show.</h4>
    }


